name: omni
services:
    omni:
        image: ghcr.io/siderolabs/omni:v0.33.0
        container_name: omni
        restart: unless-stopped
        network_mode: host
        cap_add:
            - NET_ADMIN
        command:
            - --account-id=d62239cb-615c-43a0-83e8-d33e8a59cf23
            - --name=onprem-omni
            - --cert=/tls.crt
            - --key=/tls.key
            - --siderolink-api-cert=/tls.crt
            - --siderolink-api-key=/tls.key
            - --private-key-source=file:///omni.asc
            - --event-sink-port=8091
            - --bind-addr=0.0.0.0:443
            - --siderolink-api-bind-addr=0.0.0.0:8090
            - --k8s-proxy-bind-addr=0.0.0.0:8100
            - --advertised-api-url=https://omni.greyrock.io/
            - --siderolink-api-advertised-url=https://omni.greyrock.io:8090/
            - --siderolink-wireguard-advertised-addr=10.1.1.11:50180
            - --advertised-kubernetes-proxy-url=https://omni.greyrock.io:8100/
            - --auth-auth0-enabled=true
            - --auth-auth0-domain=dev-wdolvr4vthdpmy13.us.auth0.com
            - --auth-auth0-client-id=O1IjsnLbRSevM1tCtRI3Ib0Gd2Z1qc0d
            - --initial-users=tpunderson@greyrock.io
        volumes:
            - ./data/etcd:/_out/etcd
            - /home/todd/certs/greyrock.io_ecc/fullchain.pem:/tls.crt
            - /home/todd/certs/greyrock.io_ecc/greyrock.io.key:/tls.key
            - /home/todd/apps/omni/data/omni.asc:/omni.asc
