name: omni
services:
    omni:
        image: ghcr.io/siderolabs/omni:v0.33.2
        container_name: omni
        restart: unless-stopped
        network_mode: host
        cap_add:
            - NET_ADMIN
        command:
            - --account-id=d62239cb-615c-43a0-83e8-d33e8a59cf23
            - --name=onprem-omni
            - --cert=/certs/fullchain.pem
            - --key=/certs/greyrock.io.key
            - --siderolink-api-cert=/certs/fullchain.pem
            - --siderolink-api-key=/certs/greyrock.io.key
            - --private-key-source=file:///omni.asc
            - --event-sink-port=8091
            - --bind-addr=0.0.0.0:443
            - --siderolink-api-bind-addr=0.0.0.0:8090
            - --k8s-proxy-bind-addr=0.0.0.0:8100
            - --advertised-api-url=https://omni.greyrock.io/
            - --siderolink-api-advertised-url=https://omni.greyrock.io:8090/
            - --siderolink-wireguard-advertised-addr=10.1.1.11:50180
            - --advertised-kubernetes-proxy-url=https://omni.greyrock.io:8100/
            - --auth-saml-enabled=true
            - --auth-saml-url=https://omni.greyrock.io:8443/realms/omni/protocol/saml/descriptor
        volumes:
            - /dev/net/tun:/dev/net/tun
            - /home/todd/certs/greyrock.io_ecc:/certs
            - /home/todd/apps/omni/data/omni.asc:/omni.asc
            - /home/todd/apps/omni/data/etcd:/_out/etcd
