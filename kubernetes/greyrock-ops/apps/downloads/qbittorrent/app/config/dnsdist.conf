-- udp/tcp dns listening
setLocal("127.0.0.2:53", {})

-- K8S DNS
newServer({
  address = "10.96.0.10",
  pool = "k8s"
})

-- CloudFlare DNS over TLS
newServer({
  address = "1.1.1.1:853",
  tls = "openssl",
  subjectName = "cloudflare-dns.com",
  validateCertificates = true,
  checkInterval = 10,
  checkTimeout = 2000
})
newServer({
  address = "1.0.0.1:853",
  tls = "openssl",
  subjectName = "cloudflare-dns.com",
  validateCertificates = true,
  checkInterval = 10,
  checkTimeout = 2000
})

-- Routing rules
addAction('cluster.local', PoolAction('k8s'))
